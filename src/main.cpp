#include <Arduino.h>
#include <Wire.h>
#include <Adafruit_Sensor.h>
#include <Adafruit_GFX.h>
#include <Adafruit_GFX.h>
#include <I2Cdev.h>
#include <MPU6050.h>
#include <Adafruit_SSD1306.h>
#include <SPI.h>
#include "freertos/FreeRTOS.h"
#include "freertos/task.h"
#include "freertos/semphr.h"
#include "freertos/queue.h"

#define SCREEN_WIDTH 128
#define SCREEN_HEIGHT 64
#define OLED_RESET -1
#define SCREEN_ADDRESS 0x3C
#define BUTTON_01 4
#define BUTTON_02 18
#define BUTTON_03 19
#define BUTTON_04 23
Adafruit_SSD1306 display(SCREEN_WIDTH, SCREEN_HEIGHT, &Wire, OLED_RESET);
MPU6050 sensor;

// BITMAPS GENERADOS CON: https://javl.github.io/image2cpp/
// simbolo de vida
const unsigned char health[] PROGMEM = {
    0x00, 0x00, 0x79, 0xe0, 0x7f, 0xe0, 0x7f, 0xe0, 0x7f, 0xe0, 0x7f, 0xe0, 0x3f, 0xc0, 0x1f, 0x80,
    0x0f, 0x00, 0x06, 0x00, 0x00, 0x00, 0x00, 0x00};
// simbolo de hambre
const unsigned char hunger[] PROGMEM = {
    0x00, 0x70, 0x00, 0x30, 0x00, 0xc0, 0x3f, 0x80, 0x7f, 0x00, 0x7e, 0x00, 0xfe, 0x00, 0xb4, 0x00,
    0x78, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00};
// simbolo de limpio
const unsigned char clean[] PROGMEM = {
    0x00, 0x00, 0x02, 0x00, 0x04, 0x20, 0x24, 0x60, 0x4c, 0xc0, 0x44, 0x80, 0x62, 0x40, 0x33, 0x60,
    0x12, 0x20, 0x32, 0x20, 0x64, 0x40, 0x40, 0x00};
// simbolo de jugar
const unsigned char play[] PROGMEM = {
    0x00, 0x00, 0x00, 0x00, 0x19, 0x80, 0x3f, 0xc0, 0x57, 0x60, 0x56, 0xa0, 0x7f, 0x60, 0xff, 0xf0,
    0xf0, 0xf0, 0x60, 0x60, 0x00, 0x00, 0x00, 0x00};
// simbolo de dormir
const unsigned char sleeping[] PROGMEM = {
    0x00, 0x60, 0x08, 0x20, 0x38, 0x70, 0x71, 0x00, 0x71, 0x00, 0xf0, 0x00, 0xf0, 0x40, 0xf8, 0x00,
    0x7c, 0x00, 0x7f, 0xc0, 0x3f, 0x80, 0x1f, 0x00};
// simbolo de edad
const unsigned char age[] PROGMEM = {
    0x00, 0x00, 0x0f, 0x00, 0x1f, 0x80, 0x1f, 0x80, 0x0f, 0x00, 0x0f, 0x00, 0x10, 0x80, 0x3f, 0xc0,
    0x3f, 0xc0, 0x7f, 0xe0, 0x3f, 0xc0, 0x06, 0x00};
// boton comer
const unsigned char eatButton[] PROGMEM = {
    0x80, 0x00, 0x10, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x20,
    0xf0, 0x40, 0x31, 0xfc, 0x40, 0x33, 0xfe, 0x40, 0x37, 0xfe, 0x40, 0x17, 0xff, 0x40, 0x17, 0xff,
    0x40, 0x17, 0xff, 0x40, 0x17, 0xfe, 0x40, 0x13, 0xfe, 0x40, 0x13, 0xfc, 0x40, 0x10, 0xf8, 0x40,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x80, 0x00, 0x10};
// boton dormir
const unsigned char sleepButton[] PROGMEM = {
    0x00, 0x00, 0x10, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x10, 0x00, 0x00, 0x60, 0x00, 0x02, 0x60, 0x00, 0x00, 0xe3, 0x00, 0x02, 0xe9, 0x00, 0x0c, 0xe0,
    0x00, 0x00, 0xe0, 0x00, 0x02, 0x72, 0x00, 0x00, 0x38, 0x00, 0x00, 0x1c, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x80, 0x00, 0x10};
// boton jugar
const unsigned char playButton[] PROGMEM = {
    0x80, 0x00, 0x30, 0x00, 0x00, 0x10, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x0f,
    0xfe, 0x00, 0x3f, 0xff, 0x80, 0x3b, 0xfa, 0xc0, 0x61, 0xfa, 0xc0, 0x61, 0xfa, 0xc0, 0x3b, 0xfa,
    0xc0, 0x3f, 0xff, 0x80, 0x04, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x80, 0x00, 0x10};
// boton limpiar
const unsigned char cleanButton[] PROGMEM = {
    0xc0, 0x00, 0x10, 0x80, 0x00, 0x00, 0x00, 0x06, 0x00, 0x00, 0x10, 0x00, 0x00, 0x00, 0x00, 0x03,
    0xf4, 0x00, 0x07, 0xf8, 0x00, 0x07, 0xe8, 0x00, 0x07, 0xd8, 0x00, 0x07, 0xf8, 0x00, 0x03, 0xf0,
    0x00, 0x03, 0xf0, 0x00, 0x03, 0xf0, 0x00, 0x07, 0xf8, 0x00, 0x07, 0xf8, 0x00, 0x07, 0xf8, 0x00,
    0x07, 0xf8, 0x00, 0x03, 0xf0, 0x00, 0x80, 0x00, 0x10, 0xc0, 0x00, 0x30};
// boton muerte
const unsigned char deathButton[] PROGMEM = {
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x60, 0x00, 0x01, 0xf8, 0x00, 0x01, 0xfc, 0x00, 0x03,
    0xfc, 0x00, 0x03, 0xfc, 0x00, 0x03, 0x6c, 0x00, 0x03, 0x6c, 0x00, 0x0d, 0xfb, 0x00, 0x0e, 0xf7,
    0x00, 0x0f, 0x1f, 0x00, 0x0f, 0xfc, 0x00, 0x01, 0xf8, 0x00, 0x0f, 0xff, 0x00, 0x0f, 0x0f, 0x00,
    0x0c, 0x03, 0x00, 0x0c, 0x03, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00};
// ESTADOS
const unsigned char neutral_mood[] PROGMEM = {
    0x00, 0x00, 0x00, 0x40, 0x00, 0x00, 0x00, 0x00, 0x03, 0xc0, 0x00, 0x00, 0x00, 0x00, 0x0f, 0xcc,
    0x00, 0x00, 0x00, 0x00, 0x9c, 0xfc, 0x00, 0x00, 0x00, 0x01, 0xf8, 0x7c, 0x00, 0x00, 0x00, 0x07,
    0xe0, 0x66, 0x00, 0x00, 0x00, 0x0e, 0x40, 0x46, 0x00, 0x00, 0x00, 0x3c, 0x00, 0x03, 0xe0, 0x00,
    0x01, 0xf8, 0x00, 0x03, 0xfc, 0x00, 0x07, 0xf8, 0x00, 0x01, 0xff, 0x00, 0x0f, 0xf0, 0x00, 0x01,
    0xff, 0x80, 0x1f, 0xf0, 0x00, 0x00, 0xff, 0xc0, 0x3f, 0xe0, 0x00, 0x00, 0x7f, 0xc0, 0x3f, 0xe0,
    0x00, 0x00, 0x7f, 0xe0, 0x7f, 0xc0, 0x00, 0x00, 0x3f, 0xe0, 0x7f, 0x00, 0x00, 0x00, 0x1f, 0xf0,
    0x7e, 0x00, 0x00, 0x00, 0x0f, 0xf0, 0x7e, 0x00, 0x00, 0x00, 0x0f, 0xf0, 0x7e, 0x00, 0x00, 0x00,
    0x07, 0xf0, 0x7e, 0x0c, 0x00, 0x03, 0x83, 0xf0, 0x7c, 0x3f, 0x00, 0x0f, 0xc1, 0xf0, 0x78, 0x7f,
    0x80, 0x0f, 0xe1, 0xf0, 0x78, 0x7f, 0x80, 0x1f, 0xe1, 0xe0, 0x30, 0x7f, 0x80, 0x1f, 0xe0, 0xe0,
    0x30, 0x7f, 0x80, 0x0f, 0xe0, 0xe0, 0x3c, 0x3f, 0x00, 0x0f, 0xc3, 0xc0, 0x38, 0x1e, 0x00, 0x07,
    0x81, 0x80, 0x18, 0x00, 0x00, 0x00, 0x01, 0x80, 0x18, 0x00, 0x00, 0x00, 0x01, 0x80, 0x18, 0x07,
    0xff, 0xff, 0x01, 0x80, 0x18, 0x0f, 0xff, 0xff, 0x01, 0x80, 0x18, 0x00, 0x00, 0x00, 0x01, 0x80,
    0x1d, 0xf0, 0x00, 0x00, 0x7d, 0x80, 0x1f, 0xf8, 0x00, 0x01, 0xff, 0x80, 0x3f, 0xfc, 0x00, 0x03,
    0xff, 0xc0, 0x3f, 0xfc, 0x00, 0x03, 0xff, 0xc0, 0x3f, 0xfe, 0x00, 0x03, 0xff, 0xc0, 0x1f, 0xfc,
    0x00, 0x03, 0xff, 0xc0, 0x1f, 0xff, 0xc0, 0x0f, 0xff, 0x80, 0x0f, 0xff, 0xff, 0xff, 0xff, 0x00,
    0x01, 0xff, 0xff, 0xff, 0xfc, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00};

const unsigned char Egg[] PROGMEM = {
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x0f, 0xe0,
    0x00, 0x00, 0x00, 0x00, 0x3f, 0xf8, 0x00, 0x00, 0x00, 0x00, 0xff, 0xfe, 0x00, 0x00, 0x00, 0x01,
    0xff, 0xff, 0x00, 0x00, 0x00, 0x03, 0xff, 0xff, 0x80, 0x00, 0x00, 0x07, 0xff, 0xff, 0x80, 0x00,
    0x00, 0x07, 0xff, 0xff, 0xc0, 0x00, 0x00, 0x0f, 0xff, 0xf7, 0xe0, 0x00, 0x00, 0x1f, 0xff, 0xf1,
    0xe0, 0x00, 0x00, 0x1f, 0xff, 0xe1, 0xf0, 0x00, 0x00, 0x3f, 0xff, 0xe0, 0xf0, 0x00, 0x00, 0x3f,
    0xff, 0xf1, 0xf8, 0x00, 0x00, 0x3f, 0xff, 0xf1, 0xf8, 0x00, 0x00, 0x7f, 0xff, 0xf9, 0xf8, 0x00,
    0x00, 0x7f, 0xff, 0xff, 0xfc, 0x00, 0x00, 0x7f, 0xff, 0xff, 0xfc, 0x00, 0x00, 0x7f, 0xff, 0xff,
    0xfc, 0x00, 0x00, 0xff, 0xff, 0xff, 0xfc, 0x00, 0x00, 0xff, 0xff, 0xff, 0xfc, 0x00, 0x00, 0xff,
    0xff, 0xff, 0xfc, 0x00, 0x00, 0xff, 0xff, 0xff, 0xfc, 0x00, 0x00, 0xff, 0xff, 0xff, 0xfc, 0x00,
    0x00, 0x7f, 0xff, 0xff, 0xfc, 0x00, 0x00, 0x7f, 0xff, 0xff, 0xfc, 0x00, 0x00, 0x7f, 0xff, 0xff,
    0xfc, 0x00, 0x00, 0x7f, 0xff, 0xff, 0xf8, 0x00, 0x00, 0x3f, 0xff, 0xff, 0xf8, 0x00, 0x00, 0x3f,
    0xff, 0xff, 0xf8, 0x00, 0x00, 0x3f, 0xff, 0xff, 0xf0, 0x00, 0x00, 0x1f, 0xff, 0xff, 0xf0, 0x00,
    0x00, 0x1f, 0xff, 0xff, 0xe0, 0x00, 0x00, 0x0f, 0xff, 0xff, 0xe0, 0x00, 0x00, 0x07, 0xff, 0xff,
    0xc0, 0x00, 0x00, 0x03, 0xff, 0xff, 0x80, 0x00, 0x00, 0x01, 0xff, 0xff, 0x00, 0x00, 0x00, 0x00,
    0xff, 0xfe, 0x00, 0x00, 0x00, 0x00, 0x3f, 0xf8, 0x00, 0x00, 0x00, 0x00, 0x07, 0xc0, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00};

const unsigned char SadSalud[] PROGMEM = {
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x01, 0xc0,
    0x00, 0x00, 0x00, 0x00, 0x07, 0xc0, 0x00, 0x00, 0x00, 0x00, 0x1f, 0xc8, 0x00, 0x00, 0x00, 0x00,
    0xf8, 0xf8, 0x00, 0x00, 0x00, 0x03, 0xf0, 0xfc, 0x00, 0x00, 0x00, 0x7f, 0x60, 0x6f, 0xc0, 0x00,
    0x01, 0xfe, 0x00, 0x07, 0xf8, 0x00, 0x03, 0xfc, 0x00, 0x07, 0xfe, 0x00, 0x07, 0xf8, 0x00, 0x03,
    0xff, 0x00, 0x0f, 0xf8, 0x00, 0x03, 0xff, 0x80, 0x1f, 0xf0, 0x00, 0x01, 0xff, 0xc0, 0x1f, 0xf0,
    0x00, 0x00, 0xff, 0xc0, 0x3f, 0xf0, 0x00, 0x00, 0x7f, 0xe0, 0x3f, 0xe0, 0x00, 0x00, 0x3f, 0xe0,
    0x3f, 0x00, 0x00, 0x00, 0x3f, 0xe0, 0x3f, 0x00, 0x00, 0x00, 0x1f, 0xe0, 0x3f, 0x00, 0x00, 0x00,
    0x0f, 0xe0, 0x3f, 0x03, 0x00, 0x04, 0x07, 0xe0, 0x3f, 0x03, 0x80, 0x0e, 0x07, 0xe0, 0x3e, 0x0f,
    0xc0, 0x1f, 0x03, 0xe0, 0x1c, 0x1f, 0xc0, 0x1f, 0xc3, 0xe0, 0x1c, 0x1f, 0xc0, 0x1f, 0xc3, 0xc0,
    0x1e, 0x1f, 0x80, 0x0f, 0xc3, 0xc0, 0x1e, 0x3f, 0x00, 0x0f, 0xc7, 0x80, 0x1e, 0x7c, 0x00, 0x03,
    0xe7, 0x00, 0x06, 0x7c, 0x00, 0x01, 0xe3, 0x00, 0x0c, 0x10, 0x0f, 0x80, 0xc3, 0x00, 0x0c, 0x00,
    0x1d, 0xc0, 0x03, 0x00, 0x0e, 0x00, 0x10, 0x40, 0x03, 0x00, 0x06, 0x00, 0x00, 0x00, 0x03, 0x00,
    0x06, 0x3c, 0x00, 0x03, 0xe3, 0x00, 0x06, 0xfe, 0x00, 0x07, 0xf3, 0x00, 0x07, 0xff, 0x00, 0x0f,
    0xff, 0x00, 0x07, 0xff, 0x80, 0x1f, 0xfe, 0x00, 0x07, 0xff, 0x80, 0x1f, 0xfe, 0x00, 0x07, 0xff,
    0x00, 0x0f, 0xfe, 0x00, 0x03, 0xff, 0xff, 0xff, 0xfc, 0x00, 0x01, 0xff, 0xff, 0xff, 0xf8, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00};

const unsigned char Sueno[] PROGMEM = {
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xb0, 0x00, 0x00, 0x00, 0x00, 0x00, 0x0c, 0x00,
    0x00, 0x00, 0x00, 0x03, 0xcd, 0xc0, 0x00, 0x00, 0x00, 0x07, 0x00, 0x3e, 0x00, 0x00, 0x00, 0x06,
    0x00, 0x0f, 0x80, 0x00, 0x00, 0x08, 0x00, 0x07, 0xc0, 0x00, 0x01, 0xf8, 0x00, 0x03, 0xc0, 0x00,
    0x07, 0xf8, 0x00, 0x01, 0xc0, 0x00, 0x0f, 0xf8, 0x00, 0x01, 0xe0, 0x00, 0x1f, 0xfc, 0x00, 0x00,
    0xc0, 0x00, 0x1f, 0xf8, 0x00, 0x00, 0x40, 0x00, 0x1f, 0xf0, 0x00, 0x04, 0x30, 0x00, 0x1f, 0xf0,
    0x0c, 0x07, 0x98, 0x00, 0x09, 0xe0, 0x3c, 0x02, 0x0c, 0x00, 0x02, 0x61, 0xf0, 0x00, 0x04, 0x00,
    0x0a, 0x40, 0x00, 0x00, 0x02, 0x00, 0x00, 0xc0, 0x03, 0x9f, 0x02, 0x00, 0x01, 0x80, 0x07, 0xff,
    0x82, 0x00, 0x03, 0x00, 0x1f, 0xff, 0xc6, 0x00, 0x03, 0x00, 0x3f, 0xff, 0x86, 0x00, 0x06, 0x00,
    0x3f, 0xff, 0x86, 0x00, 0x06, 0x00, 0x3f, 0xff, 0x84, 0x00, 0x02, 0x00, 0x7f, 0xff, 0xa8, 0x00,
    0x03, 0x00, 0x7f, 0xff, 0xc8, 0x00, 0x03, 0x00, 0x7f, 0xff, 0xd0, 0x00, 0x01, 0x80, 0xff, 0xff,
    0xb0, 0x00, 0x01, 0xc0, 0xff, 0xff, 0xe0, 0x00, 0x00, 0xe0, 0xff, 0xff, 0xe0, 0x00, 0x00, 0x30,
    0xff, 0xff, 0xc0, 0x00, 0x00, 0x18, 0xff, 0xff, 0x80, 0x00, 0x00, 0x0c, 0x7f, 0xff, 0x00, 0x00,
    0x00, 0x06, 0x7f, 0xfe, 0x00, 0x00, 0x00, 0x07, 0x3f, 0xfc, 0x00, 0x00, 0x00, 0x03, 0x8f, 0xf8,
    0x00, 0x00, 0x00, 0x01, 0xff, 0xf0, 0x00, 0x00, 0x00, 0x00, 0x7f, 0xc0, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00};

const unsigned char HambreSucio[] PROGMEM = {
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x01, 0xc0, 0x00, 0x00, 0x00, 0x00,
    0x07, 0xcc, 0x7f, 0x00, 0x00, 0x00, 0x5f, 0xfc, 0x7f, 0x80, 0x00, 0x00, 0xfc, 0xfc, 0xff, 0x80,
    0x00, 0x03, 0xf0, 0x6c, 0xff, 0x80, 0x00, 0x7f, 0xe0, 0x47, 0xff, 0x80, 0x01, 0xfe, 0x20, 0x07,
    0xff, 0x80, 0x03, 0xfe, 0x00, 0x03, 0xff, 0x80, 0x07, 0xfc, 0x00, 0x03, 0xff, 0x80, 0x0f, 0xf8,
    0x00, 0x01, 0xff, 0x80, 0x0f, 0xf8, 0x00, 0x00, 0xff, 0x80, 0x1f, 0xf0, 0x00, 0x00, 0x7f, 0xc0,
    0x1f, 0xf0, 0x00, 0x00, 0x7f, 0xc0, 0x1f, 0xc0, 0x00, 0x00, 0x3f, 0xc0, 0x1f, 0x80, 0x00, 0x00,
    0x1f, 0xc0, 0x1f, 0x83, 0x00, 0x06, 0x3f, 0xc0, 0x1f, 0x9f, 0xc0, 0x1f, 0xff, 0xc0, 0x1f, 0xbf,
    0xe0, 0x3f, 0xff, 0xc0, 0x1f, 0x3d, 0xf0, 0x7d, 0xe7, 0xc0, 0x0f, 0xf8, 0x70, 0x70, 0xf3, 0x80,
    0x0f, 0xf0, 0x70, 0x70, 0x73, 0x80, 0x0f, 0xf0, 0x70, 0x70, 0x73, 0x80, 0x1f, 0xf0, 0x70, 0x70,
    0x77, 0x80, 0x1f, 0xf8, 0xf0, 0x78, 0xf6, 0x00, 0x1f, 0xff, 0xe0, 0x3f, 0xe6, 0x00, 0x1f, 0xff,
    0xc0, 0x1f, 0xc3, 0x00, 0x1f, 0xc7, 0x80, 0x0f, 0x03, 0x00, 0x0f, 0x80, 0x00, 0x00, 0x03, 0x00,
    0x0f, 0x00, 0x00, 0x00, 0x03, 0x00, 0x03, 0x3c, 0x00, 0x03, 0xe3, 0x00, 0x03, 0x7f, 0x07, 0x07,
    0xf7, 0x00, 0x03, 0xff, 0x8f, 0x8f, 0xfe, 0x00, 0x03, 0xff, 0x9f, 0xcf, 0xfe, 0x00, 0x03, 0xff,
    0x80, 0x0f, 0xfe, 0x00, 0x03, 0xff, 0x80, 0x0f, 0xfc, 0x00, 0x01, 0xff, 0xff, 0xff, 0xfc, 0x00,
    0x00, 0xff, 0xff, 0xff, 0xf0, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00};

// Acciones
const unsigned char Muerto[] PROGMEM = {
    0x00, 0x00, 0x00, 0xc0, 0x00, 0x00, 0x00, 0x00, 0x03, 0xc4, 0x00, 0x00, 0x00, 0x00, 0x0f, 0xcc,
    0x00, 0x00, 0x00, 0x00, 0xbe, 0xfc, 0x00, 0x00, 0x00, 0x03, 0xf8, 0xfe, 0x00, 0x00, 0x00, 0x07,
    0xf0, 0xee, 0x00, 0x00, 0x00, 0x0f, 0x60, 0x46, 0x00, 0x00, 0x00, 0xfc, 0x40, 0x07, 0xf0, 0x00,
    0x03, 0xf8, 0x00, 0x03, 0xfe, 0x00, 0x0f, 0xf8, 0x00, 0x03, 0xff, 0x00, 0x1f, 0xf0, 0x00, 0x01,
    0xff, 0x80, 0x1f, 0xe0, 0x00, 0x00, 0xff, 0xc0, 0x3f, 0xe0, 0x00, 0x00, 0x7f, 0xe0, 0x7f, 0xe0,
    0x00, 0x00, 0x3f, 0xe0, 0x7f, 0xc0, 0x00, 0x00, 0x3f, 0xf0, 0x7f, 0x0c, 0x00, 0x40, 0x1f, 0xf0,
    0xfe, 0x0e, 0x70, 0x61, 0x0f, 0xf0, 0xfe, 0x0f, 0xf0, 0x73, 0x07, 0xf0, 0xfe, 0x07, 0xe0, 0x37,
    0x07, 0xf0, 0xfe, 0x03, 0xc0, 0x1e, 0x03, 0xf0, 0x7c, 0x07, 0xc0, 0x3c, 0x03, 0xf0, 0x7c, 0x0e,
    0xe0, 0x3e, 0x01, 0xf0, 0x78, 0x1c, 0x70, 0x77, 0x01, 0xf0, 0x78, 0x00, 0x20, 0xe3, 0x80, 0xe0,
    0x3c, 0x00, 0x00, 0x01, 0x00, 0xe0, 0x3c, 0x00, 0x00, 0x00, 0x03, 0xe0, 0x7c, 0x00, 0x00, 0x00,
    0x03, 0x80, 0x18, 0x00, 0x00, 0x00, 0x01, 0x80, 0x18, 0x00, 0x00, 0x00, 0x01, 0x80, 0x18, 0x0f,
    0xff, 0xff, 0x01, 0x80, 0x18, 0x0f, 0xff, 0xff, 0x01, 0x80, 0x1c, 0x00, 0x00, 0x00, 0x01, 0x80,
    0x1d, 0xe0, 0x00, 0x00, 0x79, 0x80, 0x1f, 0xf8, 0x00, 0x01, 0xff, 0xc0, 0x3f, 0xfc, 0x00, 0x03,
    0xff, 0xc0, 0x3f, 0xfe, 0x00, 0x03, 0xff, 0xc0, 0x3f, 0xfe, 0x00, 0x03, 0xff, 0xc0, 0x3f, 0xfc,
    0x00, 0x03, 0xff, 0xc0, 0x1f, 0xff, 0xf0, 0x7f, 0xff, 0x80, 0x0f, 0xff, 0xff, 0xff, 0xff, 0x80,
    0x03, 0xff, 0xff, 0xff, 0xfc, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00};

const unsigned char Durmiendo[] PROGMEM = {
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x01, 0xc0, 0x00, 0x00, 0x00, 0x00,
    0x07, 0xc0, 0xff, 0x00, 0x00, 0x00, 0x5f, 0xff, 0xff, 0x80, 0x00, 0x00, 0xfc, 0xff, 0x81, 0x80,
    0x00, 0x03, 0xf0, 0xc0, 0x81, 0x80, 0x00, 0x7f, 0xe1, 0xc0, 0x73, 0x80, 0x01, 0xfe, 0x20, 0xc0,
    0xe3, 0x00, 0x03, 0xfc, 0x00, 0xf0, 0xc7, 0x80, 0x07, 0xfc, 0x00, 0x71, 0x81, 0xc0, 0x0f, 0xf8,
    0x00, 0xe3, 0x80, 0xc0, 0x0f, 0xf8, 0x01, 0xc0, 0xff, 0x80, 0x1f, 0xf0, 0x01, 0x80, 0x7f, 0xc0,
    0x1f, 0xf0, 0x01, 0x80, 0x7f, 0xc0, 0x1f, 0xc0, 0x01, 0xff, 0xff, 0xc0, 0x1f, 0x80, 0x00, 0xff,
    0xdf, 0xc0, 0x1f, 0x80, 0x00, 0x00, 0x1f, 0xc0, 0x1f, 0x80, 0x00, 0x00, 0x0f, 0xc0, 0x1f, 0x80,
    0x00, 0x00, 0x07, 0xc0, 0x1f, 0x00, 0x00, 0x00, 0x07, 0xc0, 0x0e, 0x00, 0x00, 0x00, 0x03, 0x80,
    0x0e, 0x00, 0x00, 0x00, 0x03, 0x80, 0x0f, 0x00, 0x00, 0x00, 0x03, 0x80, 0x0f, 0x00, 0x00, 0x00,
    0x07, 0x80, 0x0f, 0x00, 0x00, 0x00, 0x06, 0x00, 0x06, 0x18, 0x30, 0x60, 0xc6, 0x00, 0x06, 0x1e,
    0xf0, 0x7b, 0xc3, 0x00, 0x06, 0x0f, 0xe0, 0x3f, 0x83, 0x00, 0x07, 0x00, 0x00, 0x00, 0x03, 0x00,
    0x03, 0x00, 0x00, 0x00, 0x03, 0x00, 0x03, 0x3c, 0x01, 0x83, 0xe3, 0x00, 0x03, 0x7f, 0x03, 0xe7,
    0xf7, 0x00, 0x03, 0xff, 0x83, 0xcf, 0xfe, 0x00, 0x03, 0xff, 0x80, 0x0f, 0xfe, 0x00, 0x03, 0xff,
    0x80, 0x0f, 0xfe, 0x00, 0x03, 0xff, 0x80, 0x0f, 0xfc, 0x00, 0x01, 0xff, 0xff, 0xff, 0xfc, 0x00,
    0x00, 0x7f, 0xff, 0xff, 0xf0, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00};

const unsigned char Jugando[] PROGMEM = {
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x01, 0xc0, 0x00, 0x00, 0x00, 0x00,
    0x07, 0xcc, 0x00, 0x00, 0x00, 0x00, 0x5e, 0xfc, 0x00, 0x00, 0x00, 0x00, 0xf8, 0xfc, 0x00, 0x00,
    0x00, 0x03, 0xf0, 0xec, 0x00, 0x00, 0x00, 0x07, 0x60, 0x46, 0x00, 0x00, 0x00, 0x7e, 0x00, 0x07,
    0xf0, 0x00, 0x01, 0xfc, 0x00, 0x03, 0xfc, 0x00, 0x03, 0xf8, 0x00, 0x03, 0xfe, 0x00, 0x07, 0xf8,
    0x00, 0x01, 0xff, 0x00, 0x0f, 0xf0, 0x00, 0x00, 0xff, 0x80, 0x1f, 0xf0, 0x00, 0x00, 0xff, 0xc0,
    0x1f, 0xf0, 0x00, 0x00, 0x7f, 0xc0, 0x1f, 0xc0, 0x00, 0x00, 0x3f, 0xc0, 0x3f, 0x00, 0x00, 0x00,
    0x1f, 0xe0, 0x3f, 0x00, 0x00, 0x00, 0x1f, 0xe0, 0x3f, 0x8e, 0x00, 0x01, 0x0f, 0xe0, 0x3f, 0x9e,
    0x00, 0x07, 0x07, 0xe0, 0x1f, 0x1e, 0x00, 0x1e, 0x07, 0xe0, 0x1e, 0x1f, 0xc0, 0x38, 0x03, 0xc0,
    0x1c, 0x1f, 0xc0, 0x3e, 0x03, 0xc0, 0x1c, 0x0f, 0x80, 0x0f, 0x01, 0xc0, 0x0f, 0x07, 0x00, 0x03,
    0x07, 0x80, 0x1e, 0x04, 0x00, 0x00, 0x07, 0x80, 0x06, 0x1c, 0x00, 0x01, 0xe7, 0x00, 0x06, 0x06,
    0x07, 0x01, 0x03, 0x00, 0x06, 0x06, 0x1f, 0xc3, 0x03, 0x00, 0x06, 0x03, 0xff, 0xfe, 0x03, 0x00,
    0x06, 0x00, 0xff, 0xf8, 0x03, 0x00, 0x06, 0xf8, 0xff, 0xf8, 0xfb, 0x00, 0x0f, 0xfc, 0xff, 0xf9,
    0xff, 0x00, 0x0f, 0xfe, 0x7f, 0xf3, 0xff, 0x80, 0x0f, 0xfe, 0x3f, 0xe7, 0xff, 0x80, 0x0f, 0xfe,
    0x00, 0x07, 0xff, 0x80, 0x0f, 0xff, 0x80, 0x07, 0xff, 0x00, 0x07, 0xff, 0xff, 0xff, 0xff, 0x00,
    0x01, 0xff, 0xff, 0xff, 0xfc, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00};

const unsigned char Comiendo[] PROGMEM = {
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x01, 0xc0,
    0x00, 0x00, 0x00, 0x00, 0x07, 0xc4, 0x00, 0x00, 0x00, 0x00, 0x5f, 0xdc, 0x00, 0x00, 0x00, 0x00,
    0xfc, 0xfc, 0x00, 0x00, 0x00, 0x03, 0xf0, 0xfe, 0x00, 0x00, 0x00, 0x07, 0x60, 0x46, 0x00, 0x00,
    0x00, 0x3e, 0x00, 0x07, 0xe0, 0x00, 0x01, 0xfc, 0x00, 0x03, 0xfc, 0x00, 0x03, 0xf8, 0x00, 0x03,
    0xfe, 0x00, 0x07, 0xf8, 0x00, 0x01, 0xff, 0x00, 0x0f, 0xf0, 0x00, 0x00, 0xff, 0x80, 0x1f, 0xf0,
    0x00, 0x00, 0xff, 0xc0, 0x1f, 0xf0, 0x00, 0x00, 0x7f, 0xc0, 0x3f, 0xe0, 0x00, 0x00, 0x3f, 0xe0,
    0x3f, 0x00, 0x00, 0x00, 0x1f, 0xe0, 0x3f, 0x00, 0x00, 0x00, 0x0f, 0xe0, 0x3f, 0x07, 0x00, 0x07,
    0x0f, 0xe0, 0x3f, 0x1f, 0xc0, 0x1f, 0xc7, 0xe0, 0x3f, 0x3f, 0xe0, 0x3f, 0xe7, 0xe0, 0x3e, 0x30,
    0x00, 0x00, 0x63, 0xe0, 0x3c, 0x00, 0x00, 0x00, 0x03, 0xe0, 0x1c, 0x00, 0x00, 0x00, 0x01, 0xc0,
    0x1c, 0x0f, 0xff, 0xff, 0x81, 0xc0, 0x1e, 0x07, 0xff, 0xff, 0x07, 0xc0, 0x1e, 0x07, 0xff, 0xff,
    0x03, 0xc0, 0x0e, 0x07, 0xff, 0xff, 0x03, 0x00, 0x0c, 0x07, 0xff, 0xff, 0x03, 0x00, 0x0c, 0x07,
    0xff, 0xff, 0x03, 0x80, 0x0c, 0x07, 0xff, 0xff, 0x03, 0x80, 0x0e, 0x07, 0xff, 0xff, 0x03, 0x80,
    0x0e, 0xf3, 0xff, 0xfe, 0xfb, 0x80, 0x0f, 0xff, 0xff, 0xff, 0xff, 0x80, 0x1f, 0xff, 0xff, 0xff,
    0xff, 0x80, 0x1f, 0xfe, 0xff, 0xff, 0xff, 0x80, 0x1f, 0xfe, 0x7f, 0xf7, 0xff, 0x80, 0x0f, 0xff,
    0x1f, 0xc3, 0xff, 0x80, 0x0f, 0xff, 0xff, 0xff, 0xff, 0x00, 0x03, 0xff, 0xff, 0xff, 0xfe, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00};

const unsigned char Limpiandose[] PROGMEM = {
    0x00, 0x00, 0x00, 0x40, 0x00, 0x00, 0x00, 0x00, 0x03, 0xc5, 0xc0, 0x00, 0x00, 0x00, 0x0f, 0xcf,
    0xe0, 0x00, 0x00, 0x00, 0x9e, 0xdf, 0xe0, 0x00, 0x00, 0x01, 0xf8, 0xff, 0xf0, 0x00, 0x00, 0x07,
    0xf0, 0xff, 0xf0, 0x00, 0x00, 0x1f, 0xe0, 0x67, 0xf0, 0x00, 0x01, 0xfe, 0x40, 0x47, 0xff, 0x00,
    0x07, 0xfc, 0x00, 0x03, 0xff, 0x80, 0x0f, 0xf8, 0x00, 0x1f, 0xff, 0xc0, 0x1f, 0xf0, 0x00, 0x1f,
    0xff, 0xc0, 0x3f, 0xe0, 0x00, 0x03, 0xff, 0xe0, 0x3f, 0xe0, 0x00, 0x01, 0xff, 0xe0, 0x7f, 0xe0,
    0x00, 0x00, 0xff, 0xf0, 0x7f, 0xc0, 0x00, 0x00, 0xbf, 0xf0, 0xff, 0x80, 0x00, 0x00, 0x9f, 0xf8,
    0xfe, 0x00, 0x00, 0x00, 0x8f, 0xf8, 0xfc, 0x00, 0x00, 0x00, 0x0f, 0xf8, 0xff, 0xff, 0xff, 0xff,
    0xff, 0xf8, 0xff, 0xff, 0x1f, 0xfe, 0x7f, 0xf8, 0xff, 0xff, 0x3f, 0xfc, 0x7f, 0xf8, 0x7f, 0xfe,
    0x7f, 0xfc, 0xfd, 0xf8, 0x79, 0xfc, 0xff, 0xf9, 0xf9, 0xf0, 0x71, 0xf9, 0xff, 0xf3, 0xf8, 0xf0,
    0x30, 0xf3, 0xff, 0xe7, 0xf0, 0xf0, 0x7c, 0xff, 0xf0, 0xff, 0xf1, 0xe0, 0x78, 0x7f, 0xe0, 0x7f,
    0xf3, 0xe0, 0x78, 0x7f, 0xc0, 0x3f, 0xe1, 0x80, 0x18, 0x0c, 0x00, 0x01, 0x81, 0x80, 0x18, 0x0c,
    0x06, 0x03, 0x01, 0xc0, 0x18, 0x06, 0x1f, 0x87, 0x01, 0xc0, 0x18, 0x07, 0xf9, 0xfe, 0x01, 0xc0,
    0x18, 0x01, 0xe0, 0x7c, 0x01, 0xc0, 0x19, 0xf0, 0x00, 0x00, 0xf9, 0xc0, 0x1f, 0xf8, 0x00, 0x01,
    0xfd, 0xc0, 0x1f, 0xfe, 0x00, 0x03, 0xff, 0x80, 0x3f, 0xfe, 0x00, 0x07, 0xff, 0xc0, 0x3f, 0xfe,
    0x00, 0x07, 0xff, 0xc0, 0x1f, 0xfe, 0x00, 0x07, 0xff, 0x80, 0x1f, 0xff, 0xc0, 0x1f, 0xff, 0x80,
    0x0f, 0xff, 0xff, 0xff, 0xff, 0x00, 0x03, 0xff, 0xff, 0xff, 0xfe, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00};

// Status variables
unsigned int limpieza;
unsigned int hambre;
unsigned int aburrimiento;
unsigned int sueno;
unsigned int salud;
unsigned int edad;

double k;                     // Factor de crecimiento
int option;                   // Opcion escogida
bool left, right, enter, esc; // Botones

// Variables de MPU6050
int16_t ax, ay, az;
int16_t gx, gy, gz;

// Prototipos de funciones para tareas
void vUITask(void *pvParameters);          // Interfaz grafica
void vUserInputTask(void *pvParameters);   // Recibir el input del usuario
void vStateUpdateTask(void *pvParameters); // Actualizar variables de estado
void vAgeTask(void *pvParameters);         // Envejecer
void vActionTask(void *pvParameters);      // Alimentar
void vGameTask(void *pvParameters);        // Jugar (Giroscopio)

// Definición de colas y semáforos
QueueHandle_t xUserInputQueue; // Cola con las entradas de los botones
QueueHandle_t xActionQueue;    // Cola con las entradas de los botones
SemaphoreHandle_t xDataMutex;  // Mutex de los datos de estado
SemaphoreHandle_t xMoodSemph;  // Semaforo del mood

void setup()
{
  Serial.begin(9600);
  Wire.begin();
  sensor.initialize();
  pinMode(BUTTON_01, INPUT);
  pinMode(BUTTON_02, INPUT);
  pinMode(BUTTON_03, INPUT);
  pinMode(BUTTON_04, INPUT);
  left = digitalRead(BUTTON_01);
  right = digitalRead(BUTTON_02);
  enter = digitalRead(BUTTON_03);
  esc = digitalRead(BUTTON_04);

  limpieza = 100;
  hambre = 100;
  sueno = 100;
  salud = 100;
  aburrimiento = 100;

  option = 0;
  edad = 0;
  k = 0.2; // 0.05;

  if (!display.begin(SSD1306_SWITCHCAPVCC, SCREEN_ADDRESS))
  {
    Serial.println(F("SSD1306 allocation failed"));
    for (;;)
      ;
  }

  if (sensor.testConnection())
    Serial.println("Sensor iniciado correctamente");
  else
    Serial.println("Error al iniciar el sensor");

  // Crear colas y semáforos
  xUserInputQueue = xQueueCreate(10, sizeof(uint8_t));
  xActionQueue = xQueueCreate(10, sizeof(uint8_t));
  xDataMutex = xSemaphoreCreateMutex();
  xMoodSemph = xSemaphoreCreateMutex();

  // Crear tareas
  xTaskCreate(vUITask, "UI Task", 32000, NULL, 2, NULL);
  xTaskCreate(vUserInputTask, "User Input Task", 1000, NULL, 2, NULL);
  xTaskCreate(vStateUpdateTask, "State Update Task", 1000, NULL, 1, NULL);
  xTaskCreate(vAgeTask, "Age Task", 1000, NULL, 1, NULL);
  xTaskCreate(vActionTask, "Action Task", 16000, NULL, 1, NULL);
  xTaskCreate(vGameTask, "Game Task", 16000, NULL, 1, NULL);
}

void loop()
{
  // No hacer nada
}

uint8_t getUserInput()
{
  left = digitalRead(BUTTON_01);
  right = digitalRead(BUTTON_02);
  enter = digitalRead(BUTTON_03);
  esc = digitalRead(BUTTON_04);
  if (left == 1)
  {
    return 1;
  }
  else if (right == 1)
  {
    return 2;
  }
  else if (enter == 1)
  {
    return 3;
  }
  else if (esc == 1)
  {
    return 4;
  }
  return 0;
}

void vUITask(void *pvParameters)
{
  while (1)
  {
    uint32_t rxElement = 0;
    if (xQueueReceive(xUserInputQueue, (void *)&rxElement, (TickType_t)10))
    {
      switch (rxElement)
      {
      case 1:
        option = ((option - 1) % 5);
        if (option < 0)
        {
          option += 5;
        }
        break;
      case 2:
        option = ((option + 1) % 5);
        break;
      case 3:
        if (xQueueSend(xActionQueue, (void *)&option, (TickType_t)0) == true)
        {
          //Do nothing
        }

        break;
      case 4:
        break;
      }
    }
    display.clearDisplay();
    display.setTextSize(1);
    display.setTextColor(WHITE);
    // Simbolo mascota
    xSemaphoreTake(xMoodSemph, portMAX_DELAY);
    if (salud == 0)
    {
      display.clearDisplay();
      display.drawBitmap(41, 9, Muerto, 45, 45, WHITE);
      display.display();
      vTaskDelay(pdMS_TO_TICKS(200));
      continue;
    }
    else if (edad < 2)
    {
      display.drawBitmap(0, 0, Egg, 45, 45, WHITE);
    }
    else if (aburrimiento <= 15 or salud <= 30)
    {
      display.drawBitmap(0, 0, SadSalud, 45, 45, WHITE);
    }
    else if (sueno <= 20)
    {
      display.drawBitmap(0, 0, Sueno, 45, 45, WHITE);
    }
    else if (hambre <= 20 or limpieza <= 10)
    {
      display.drawBitmap(0, 0, HambreSucio, 45, 45, WHITE);
    }
    else
    {
      display.drawBitmap(0, 0, neutral_mood, 45, 45, WHITE);
    }
    xSemaphoreGive(xMoodSemph);
    // Simbolos de estado
    display.drawBitmap(55, 0, clean, 12, 12, WHITE);
    display.setCursor(69, 3); // x+14, y+3
    display.print(limpieza);
    display.drawBitmap(90, 0, hunger, 12, 12, WHITE);
    display.setCursor(104, 3);
    display.print(hambre);
    display.drawBitmap(55, 15, sleeping, 12, 12, WHITE);
    display.setCursor(69, 18);
    display.print(sueno);
    display.drawBitmap(90, 15, play, 12, 12, WHITE);
    display.setCursor(104, 18);
    display.print(aburrimiento);
    display.drawBitmap(55, 30, health, 12, 12, WHITE);
    display.setCursor(69, 33);
    display.print(salud);
    display.drawBitmap(90, 30, age, 12, 12, WHITE);
    display.setCursor(104, 33);
    display.print(edad);
    // Simbolos botones
    switch (option)
    {
    case 0:
      display.drawBitmap(0, 44, eatButton, 20, 20, BLACK, WHITE);
      display.drawBitmap(25, 44, cleanButton, 20, 20, WHITE);
      display.drawBitmap(50, 44, playButton, 20, 20, WHITE);
      display.drawBitmap(75, 44, sleepButton, 20, 20, WHITE);
      display.drawBitmap(100, 44, deathButton, 20, 20, WHITE);
      break;
    case 1:
      display.drawBitmap(0, 44, eatButton, 20, 20, WHITE);
      display.drawBitmap(25, 44, cleanButton, 20, 20, BLACK, WHITE);
      display.drawBitmap(50, 44, playButton, 20, 20, WHITE);
      display.drawBitmap(75, 44, sleepButton, 20, 20, WHITE);
      display.drawBitmap(100, 44, deathButton, 20, 20, WHITE);
      break;
    case 2:
      display.drawBitmap(0, 44, eatButton, 20, 20, WHITE);
      display.drawBitmap(25, 44, cleanButton, 20, 20, WHITE);
      display.drawBitmap(50, 44, playButton, 20, 20, BLACK, WHITE);
      display.drawBitmap(75, 44, sleepButton, 20, 20, WHITE);
      display.drawBitmap(100, 44, deathButton, 20, 20, WHITE);
      break;
    case 3:
      display.drawBitmap(0, 44, eatButton, 20, 20, WHITE);
      display.drawBitmap(25, 44, cleanButton, 20, 20, WHITE);
      display.drawBitmap(50, 44, playButton, 20, 20, WHITE);
      display.drawBitmap(75, 44, sleepButton, 20, 20, BLACK, WHITE);
      display.drawBitmap(100, 44, deathButton, 20, 20, WHITE);
      break;
    case 4:
      display.drawBitmap(0, 44, eatButton, 20, 20, WHITE);
      display.drawBitmap(25, 44, cleanButton, 20, 20, WHITE);
      display.drawBitmap(50, 44, playButton, 20, 20, WHITE);
      display.drawBitmap(75, 44, sleepButton, 20, 20, WHITE);
      display.drawBitmap(100, 44, deathButton, 20, 20, BLACK, WHITE);
      break;
    default:
      display.drawBitmap(0, 44, eatButton, 20, 20, WHITE);
      display.drawBitmap(25, 44, cleanButton, 20, 20, WHITE);
      display.drawBitmap(50, 44, playButton, 20, 20, WHITE);
      display.drawBitmap(75, 44, sleepButton, 20, 20, WHITE);
      display.drawBitmap(100, 44, deathButton, 20, 20, WHITE);
    }
    display.display();
    vTaskDelay(pdMS_TO_TICKS(200));
  }
}

void vUserInputTask(void *pvParameters)
{
  while (1)
  {
    if (edad < 2)
    {
      vTaskDelay(pdMS_TO_TICKS(350));
      continue;
    }
    uint32_t input = getUserInput();
    if (input != 0 && xQueueSend(xUserInputQueue, (void *)&input, (TickType_t)0) == pdTRUE)
    {
      if (salud == 0)
      {
        ESP.restart();
      }
    }
    vTaskDelay(pdMS_TO_TICKS(350));
  }
}

void vAgeTask(void *pvParameters)
{
  while (1)
  {
    edad++;
    vTaskDelay(pdMS_TO_TICKS(4000 / k));
  }
}

void vStateUpdateTask(void *pvParameters)
{
  while (1)
  {
    if (edad < 2 || salud == 0)
    {
      vTaskDelay(pdMS_TO_TICKS(400 / k));
      continue;
    }
    xSemaphoreTake(xDataMutex, portMAX_DELAY);

    (int(limpieza) - 2) <= 0 ? limpieza = 0 : limpieza -= 2;
    (int(hambre) - 3) <= 0 ? hambre = 0 : hambre -= 3;
    (int(sueno) - 2) <= 0 ? sueno = 0 : sueno -= 2;
    (int(aburrimiento) - 3) <= 0 ? aburrimiento = 0 : aburrimiento -= 3;

    (hambre <= 20 && (int(salud) - 2) >= 0) ? salud -= 2 : salud -= 0;
    (sueno <= 20 && (int(salud) - 2) >= 0) ? salud -= 2 : salud -= 0;
    (aburrimiento <= 15 && (int(salud) - 1) >= 0) ? salud -= 1 : salud -= 0;
    (limpieza <= 10 && (int(salud) - 1) >= 0) ? salud -= 1 : salud -= 0;

    xSemaphoreGive(xDataMutex);
    vTaskDelay(pdMS_TO_TICKS(400 / k));
  }
}

void vActionTask(void *pvParameters)
{
  while (1)
  {
    if (edad < 2 || salud == 0)
    {
      vTaskDelay(pdMS_TO_TICKS(100));
      continue;
    }
    uint32_t rxElement = 0;
    if (xQueueReceive(xActionQueue, (void *)&rxElement, (TickType_t)10))
    {

      switch (rxElement)
      {
      case 0:
        xSemaphoreTake(xMoodSemph, portMAX_DELAY);
        display.clearDisplay();
        display.drawBitmap(41, 9, Comiendo, 45, 45, WHITE);
        display.display();
        xSemaphoreTake(xDataMutex, portMAX_DELAY);
        (int(hambre) + 10) >= 100 ? hambre = 100 : hambre += 10;
        (int(salud) + 5) >= 100 ? salud = 100 : salud += 5;
        xSemaphoreGive(xDataMutex);
        vTaskDelay(pdMS_TO_TICKS(4000));
        xSemaphoreGive(xMoodSemph);
        break;
      case 1:
        xSemaphoreTake(xMoodSemph, portMAX_DELAY);
        display.clearDisplay();
        display.drawBitmap(41, 9, Limpiandose, 45, 45, WHITE);
        display.display();
        xSemaphoreTake(xDataMutex, portMAX_DELAY);
        (int(limpieza) + 10) >= 100 ? limpieza = 100 : limpieza += 10;
        (int(salud) + 5) >= 100 ? salud = 100 : salud += 5;
        xSemaphoreGive(xDataMutex);
        vTaskDelay(pdMS_TO_TICKS(4000));
        xSemaphoreGive(xMoodSemph);
        break;
      case 2:
        xSemaphoreTake(xMoodSemph, portMAX_DELAY);
        display.clearDisplay();
        display.drawBitmap(41, 9, Jugando, 45, 45, WHITE);
        display.display();
        xSemaphoreTake(xDataMutex, portMAX_DELAY);
        (int(aburrimiento) + 10) >= 100 ? aburrimiento = 100 : aburrimiento += 10;
        (int(salud) + 5) >= 100 ? salud = 100 : salud += 5;
        xSemaphoreGive(xDataMutex);
        vTaskDelay(pdMS_TO_TICKS(4000));
        xSemaphoreGive(xMoodSemph);
        break;
      case 3:
        xSemaphoreTake(xMoodSemph, portMAX_DELAY);
        display.clearDisplay();
        display.drawBitmap(41, 9, Durmiendo, 45, 45, WHITE);
        display.display();
        xSemaphoreTake(xDataMutex, portMAX_DELAY);
        (int(sueno) + 10) >= 100 ? sueno = 100 : sueno += 10;
        (int(salud) + 5) >= 100 ? salud = 100 : salud += 5;
        xSemaphoreGive(xDataMutex);
        vTaskDelay(pdMS_TO_TICKS(4000));
        xSemaphoreGive(xMoodSemph);
        break;
      case 4:
        xSemaphoreTake(xMoodSemph, portMAX_DELAY);
        display.clearDisplay();
        display.drawBitmap(41, 9, Muerto, 45, 45, WHITE);
        display.display();
        vTaskDelay(pdMS_TO_TICKS(4000));
        ESP.restart();
        xSemaphoreGive(xMoodSemph);
        break;
      }
    }
    vTaskDelay(pdMS_TO_TICKS(100));
  }
}

void vGameTask(void *pvParameters)
{
  while (1)
  {
    if (edad < 2 || salud == 0)
    {
      vTaskDelay(pdMS_TO_TICKS(100));
      continue;
    }
    sensor.getAcceleration(&ax, &ay, &az);
    sensor.getRotation(&gx, &gy, &gz);
    if (ax >= 23000)
    {
      xSemaphoreTake(xMoodSemph, portMAX_DELAY);
      display.clearDisplay();
      display.drawBitmap(41, 9, Jugando, 45, 45, WHITE);
      display.display();
      xSemaphoreTake(xDataMutex, portMAX_DELAY);
      (int(aburrimiento) + 20) >= 100 ? aburrimiento = 100 : aburrimiento += 20;
      (int(salud) + 10) >= 100 ? salud = 100 : salud += 10;
      xSemaphoreGive(xDataMutex);
      vTaskDelay(pdMS_TO_TICKS(4000));
      xSemaphoreGive(xMoodSemph);
    }
    vTaskDelay(pdMS_TO_TICKS(100));
  }
}
